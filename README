# Kubernetes Cluster Setup using kubeadm (Master & Worker)

This repository provides **automated shell scripts** to set up a **Kubernetes cluster using kubeadm** on Ubuntu systems.

The setup follows **official Kubernetes best practices**, using:

* **containerd** as the Kubernetes container runtime
* **Docker** for developer convenience (image building, debugging, CI/CD)

---

## ğŸ“Œ Prerequisites

* Ubuntu 20.04 / 22.04
* Minimum 2 CPUs (Master)
* At least 2 GB RAM (4 GB recommended for Master)
* Passwordless `sudo` access
* Internet connectivity

---

## ğŸ§± Architecture

* **1 Master Node**
* **1 or more Worker Nodes**
* Runtime: **containerd**
* Kubernetes version: **v1.29**

---

## ğŸš€ Master Node Setup

Run the following commands **on the Master node**:

```bash

sudo -i
chmod +x k8s-master.sh
./k8s-master.sh

```

### Initialize the Kubernetes control plane:

```bash

kubeadm init

```

> Save the `kubeadm join` command printed at the end â€” it is required for worker nodes.

---

## ğŸš€ Worker Node Setup

Run the following commands **on each Worker node**:

```bash
sudo -i
chmod +x k8s-worker.sh
./k8s-worker.sh
```

### Join the worker node to the cluster:

```bash
kubeadm join <MASTER-IP>:6443 --token <TOKEN> --discovery-token-ca-cert-hash sha256:<HASH>
```

---

## ğŸ³ Why Docker is Installed?

Kubernetes **does NOT require Docker** as a runtime anymore.

* Kubernetes uses **containerd**
* Docker is installed **only for**:

  * Image building
  * Debugging containers
  * CI/CD workflows
  * Developer convenience

This follows **modern Kubernetes standards**.

---

## ğŸ” Security & Best Practices

* Swap disabled (mandatory for Kubernetes)
* Required kernel modules loaded
* Proper sysctl configuration
* Kubernetes components version locked
* Services enabled on boot

---

## ğŸ“Œ Next Recommended Steps

After cluster setup:

* Install a **CNI plugin** (e.g., Calico)
* Configure `kubectl` for non-root user
* Add monitoring (Prometheus + Grafana)
* Enable HPA and NetworkPolicies

---

## âœ… Summary

âœ” Fully automated installation
âœ” Separate Master & Worker scripts
âœ” Production & interview ready
âœ” Clean and reusable for real projects

---

Happy Kubernetes Learning â˜¸ï¸
**Built with a DevOps Engineer mindset**

âœ… STEP 1 â€” Initialize Control Plane (MASTER)

kubeadm init \
  --pod-network-cidr=192.168.0.0/16 \
  --apiserver-cert-extra-sans=$(hostname -I | awk '{print $1}')


Configure kubectl:

mkdir -p ~/.kube
sudo cp /etc/kubernetes/admin.conf ~/.kube/config
sudo chown $(id -u):$(id -g) ~/.kube/config

âœ… STEP 2 â€” Install CNI (Calico)

kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.3/manifests/calico.yaml

Wait:

kubectl get pods -n kube-system

âœ… STEP 3 â€” Join Worker Node(s)

On MASTER:

kubeadm token create --print-join-command

On WORKER:

kubeadm join <MASTER-IP>:6443 --token <TOKEN> \
--discovery-token-ca-cert-hash sha256:<HASH>

Verify:

kubectl get nodes

âœ… STEP 4 â€” Workload Validation

kubectl create deployment nginx --image=nginx
kubectl scale deployment nginx --replicas=2
kubectl get pods

âœ… STEP 5 â€” Metrics Server

kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml

kubectl patch deployment metrics-server -n kube-system \
  --type=json -p='[
    {"op":"add","path":"/spec/template/spec/containers/0/args/-","value":"--kubelet-insecure-tls"}
  ]'


Verify:

kubectl top nodes
kubectl top pods

âœ… STEP 6 â€” HPA

kubectl set resources deployment nginx \
  --requests=cpu=100m --limits=cpu=200m

kubectl autoscale deployment nginx \
  --cpu-percent=50 --min=1 --max=5

kubectl get hpa


âœ… STEP 7 â€” PodDisruptionBudget

vi nginx-pdb.yaml

apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: nginx-pdb
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: nginx


kubectl apply -f nginx-pdb.yaml
kubectl get pdb

âœ… STEP 8 â€” ClusterIP (Internal Service)

kubectl expose deployment nginx \
  --name=nginx-clusterip \
  --port=80 \
  --target-port=80 \
  --type=ClusterIP

Test:

kubectl run test --rm -it --image=busybox -- /bin/sh

wget -qO- http://nginx-clusterip.default.svc.cluster.local











